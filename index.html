<html lang="ca_ES">
  <head>
    <meta charset="utf-8">
    <title>Generador de noms del dragonat</title>
    <style>
    html {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      margin: 2em;
    }
    body {
      border: 1px solid gray;
      border-radius: 50px;
      width: 200px;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 15px;
      display: flex;
    }

    #text {
      margin-bottom: 1em;
      line-height: 1.5em;
    }

    #button {

    }
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>
    <script>
    var vowels = [
      "a", "e", "i", "o", "u"
    ]

    var consonantsBeforeVowel = [
      "c","t","h","b","p","f","m","n","r",
    ];

    var consonantsAfterVowel = [
      "t","p","f","m","n"
    ];

    var consonantsBetweenVowels = [
      "dn", "bd", "pt", "v","r"
    ];

    var distributionOfnumberOfSyllables = [
      1,
      2,2,2,2,
      3,3,3,3,3,3,3,3,
      4,4,4,4,4,
      5,5,
      6,
    ];

    var lastSyllabe = null;
    var lastLetter = null;

    function randomElement(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function getVowelConsonant() {
      return randomElement(vowels)+randomElement(consonantsAfterVowel);
    }

    function getConsonantVowel() {
      return randomElement(consonantsBeforeVowel)+randomElement(vowels);
    }

    function getConsonantsBetweenVowels() {
      return randomElement(consonantsBetweenVowels);
    }

    function getPreviousLetter( ) {
      return lastLetter;
    }

    function isPreviousLetterAVowel(i, word) {
      return vowels.includes(getPreviousLetter());
    }

    function isPreviousLetterAConsonant(i, word) {
      return consonants.includes(getPreviousLetter());
    }

    function isPreviousLetterAHypen(i, word) {
      return getPreviousLetter() == "-";
    }

    function isPreviousLetterASpace(i, word) {
      return getPreviousLetter() == " ";
    }

    function getSyllabe(i, word) {
      if ( i == 0 ) {
        if ( Math.random() <= 0.6 ) { //60% of words start with consonant+vowel
          return getConsonantVowel();
        } else {
          return getVowelConsonant();
        }
      } else {
        if ( (i+1) < word.length ) { //not the last syllabe
          if ( Math.random() <= 0.05 ) { //5% of provability of a hypen
             return "-";
          }
          if ( Math.random() <= 0.05 ) { //5% of provability of a space
             return " ";
          }
        }

        if ( isPreviousLetterAVowel(i, word) ) {
          if ( Math.random() <= 0.4 ) { //40% of provability of a interVowels
            return getConsonantsBetweenVowels();
          }
        } else if ( isPreviousLetterAHypen(i, word) || isPreviousLetterASpace(i, word) ) {
          if ( Math.random() <= 0.6 ) { //60% of words start with consonant+vowel
            return getConsonantVowel();
          } else {
            return getVowelConsonant();
          }
        }
      }
      //the default sylabe is vowelConsonant
      return getVowelConsonant();
    }

    function word(){
      var word = "";
      var totalNumberOfSyllables = randomElement(distributionOfnumberOfSyllables);

      var word = new Array(totalNumberOfSyllables);
      for (var i = 0; i < word.length; i++){
        var syllabe = getSyllabe(i, word);
        lastSyllabe = syllabe;
        lastLetter = syllabe.charAt(syllabe.length-1);
        word[i] = syllabe;
      }
      word = word.join("");
      word = word.charAt(0).toUpperCase() + word.slice(1)
      return word;
    }

    function generate() {
      var text = "";
      var paraulesAGenerar = 10;
      for (var p = 0; p < paraulesAGenerar; p++) {
        text = text+"<br>"+word();
      }

      $('#text').html(text);
    }
    $( document ).ready(function() {
      generate();

      $('#button').click(function(event){
        event.preventDefault();
        generate();
      })
    });
    </script>
  </head>
  <body>
    <div id="text"></div>
    <input id="button"
       type="button"
       value="generar nous noms">
  </body>
</html>
